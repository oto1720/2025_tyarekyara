# 現在の状況整理

## 何ができていて、何ができていないか

### ✅ できていること

1. **マッチング処理**
   - デバッグページで手動マッチングを実行すると成功する
   - Firestoreの`debate_matches`コレクションにデータが追加される
   - エントリーのステータスが`matched`になる

2. **データベース**
   - イベントが作成できる
   - エントリーが作成できる
   - マッチが作成できる

### ❌ できていないこと

1. **画面遷移**
   - マッチング成立後、画面が変わらない
   - 待機画面から動かない
   - ボトムナビゲーションのディベートタブを押しても反応しない

2. **ルーム作成**
   - `debate_rooms`コレクションにルームが作成されない
   - マッチの`roomId`が`null`のまま

## なぜこうなっているか（原因）

### 原因1: ルームが作成されない

**本来の流れ:**
```
イベント締切 → イベントステータス「matching」に変更
            → Cloud Functionsがルーム作成
            → イベント開催時刻 → ルームがアクティブ化
```

**実際に起きたこと:**
```
イベント締切 → イベントステータスが「matching」をスキップして「inProgress」に
            → ルーム作成処理が実行されなかった
```

### 原因2: 画面遷移が動かない

**待機画面のコードが見ているもの:**
1. エントリーのステータス（`matched`になったか）
2. ルームが作成されたか

**問題:**
- エントリーは`matched`になっている ✅
- でもルームが作成されていない ❌
- そのため画面遷移のコードが動かない

## 次にすべきこと

### ステップ1: 現在の状態を確認

以下をFirebase Consoleで確認してください:

1. **イベント（`debate_events`）**
   - ID: `test_event_001`
   - `status`フィールド: 今何になっていますか？

2. **エントリー（`debate_entries`）**
   - あなたのエントリーの`status`: `matched`になっていますか？
   - `matchId`: 値が入っていますか？

3. **マッチ（`debate_matches`）**
   - マッチは作成されていますか？
   - `roomId`フィールド: `null`ですか？値が入っていますか？

4. **ルーム（`debate_rooms`）**
   - ルームは1件も作成されていませんか？

### ステップ2: 問題を切り分ける

確認結果を教えてください。それに基づいて、どこから修正すべきか判断します。

## 用語説明（わかりにくいものだけ）

- **Provider**: Flutterでデータの変更を自動で検知する仕組み
- **StreamProvider**: リアルタイムでデータの変更を監視し続けるProvider
- **FutureProvider**: 一度だけデータを取得するProvider（変更は検知しない）
- **Cloud Functions**: サーバー側で自動実行されるプログラム（時刻になったら○○する、など）
